import axiosA from"axios";import{toastController}from"@ionic/vue";export class AsyncStorage{constructor(){this.storage={}}set(key,val){if(key.includes(".")){for(var schema=this.storage,pList=key.split("."),len=pList.length,i=0;i<len-1;i++){var elem=pList[i];schema[elem]||(schema[elem]={}),schema=schema[elem]}schema[pList[len-1]]=val,console.log(schema[pList[len-1]])}else this.storage[key]=val,"object"==typeof val?localStorage.setItem("async_"+key,JSON.stringify(val)):localStorage.setItem("async_"+key,val)}get(key){return isJsonString(localStorage.getItem("async_"+key))?JSON.parse(localStorage.getItem("async_"+key)):localStorage.getItem("async_"+key)}isset(key){return null!=localStorage.getItem("async_"+key)}remove(key){delete this.storage[key],localStorage.removeItem(key)}objectify(stringObj){return stringObj=stringObj.replaceAll("&#34;",'"'),stringObj=JSON.parse(stringObj)}}function isJsonString(str){try{JSON.parse(str)}catch(e){return!1}return!0}window.onload=()=>{for(let s in localStorage)s.includes("async_")&&(lStore.storage[s.replaceAll("async_","")]=localStorage.getItem(s))};export const lStore=new AsyncStorage;class AxiosR{constructor(baseUrl,defHeaders=null){this.baseUrl=baseUrl,this.defHeaders=defHeaders}get(endpoint){return axiosA({method:"get",url:endpoint})}post(endpoint,headers=null,body=null){let params={method:"post",url:this.baseUrl+endpoint};return"default"==headers?params.headers=this.defHeaders:null!=headers&&(params.headers=headers),null!=body&&(params.data=toFormData(body)),axiosA(params)}}export const axios=new AxiosR("https://www.4angelshc.com/mobile/",{PWAuth:lStore.get("user_token")});export function elementLoad(selector){return new Promise(resolve=>{var check=setInterval((function(){null!=document.querySelector(selector)&&(clearInterval(check),resolve(document.querySelector(selector)))}),100)})}export function optimizeImage(src){let cnv=document.createElement("canvas");document.body.appendChild(cnv);let ctx=cnv.getContext("2d"),img=new Image;const maxdim=700;return img.src=src,new Promise(resolve=>{img.onload=()=>{img.width>=img.height?(cnv.width=700,cnv.height=img.height/img.width*700):(cnv.height=700,cnv.width=img.width/img.height*700),ctx.drawImage(img,0,0,cnv.width,cnv.height);const cdata=cnv.toDataURL();cnv.remove(),resolve(cdata)}})}export function validateForm(obj,rules){let validated={allValid:!0};for(let r in rules)if(("required"==rules[r]||rules[r].isRequired)&&null==obj[r]||""==obj[r])validated[r]="empty";else if(("required"!=rules[r]||rules[r].isRequired)&&null==obj[r]||""==obj[r])validated[r]=!0;else if("callback"!=r){let emailregex=/[a-z0-9._]+@[a-z]+\.[a-z]{2,3}/i,intregex=/[0-9]+/;if(validated[r]=!0,rules[r].isEmail&&obj[r].toLowerCase().match(emailregex))validated[r]=!0;else if(rules[r].isEmail){validated[r]="invalid_email";break}if(rules[r].isInteger&&obj[r].match(intregex))validated[r]=!0;else if(rules[r].isInteger){validated[r]="invalid_number";break}if(null!=rules[r].regexMatch&&obj[r].match(rules[r].regexMatch))validated[r]=!0;else if(null!=rules[r].regexMatch){validated[r]="value_and_regex_not_match";break}if(null!=rules[r].equalTo&&obj[r]==rules[r].equalTo)validated[r]=!0;else if(null!=rules[r].equalTo){validated[r]="values_not_match";break}if("number"==typeof rules[r].maxChars&&rules[r].maxChars>=obj[r].length)validated[r]=!0;else if("number"==typeof rules[r].maxChars){validated[r]="invalid_length_max";break}if("number"==typeof rules[r].minChars&&rules[r].minChars<=obj[r].length)validated[r]=!0;else if("number"==typeof rules[r].minChars){validated[r]="invalid_length_min";break}}let someEmpty=!1;if(null!=rules.callback)for(let v in validated)if("empty"===validated[v]){validated.allValid=!1,rules.callback(),someEmpty=!0;break}if(!someEmpty)for(let v in validated)if(1!=validated[v]&&(validated.allValid=!1,null!=rules[v].callback)){rules[v].callback(validated[v],v);break}return validated}export async function openToast(msg,type){try{await toastController.dismiss()}catch(e){console.log(e)}const toast=await toastController.create({message:msg,color:type,duration:2e3,position:"top"});return toast.present()}function toFormData(obj){var fd=new FormData;for(var i in obj)fd.append(i,obj[i]);return fd}export function formatDateString(dateString){let digits=dateString.matchAll(/[0-9]+/g),digitsArr=[];for(const d of digits)1==new String(d).length?digitsArr.push("0"+d):digitsArr.push(d);let newString="";for(let i=0;i<digitsArr.length;i++)i<2?newString=newString+digitsArr[i]+"-":2==i?newString=newString+digitsArr[i]+" ":i>2&&i!=digitsArr.length-1?newString=newString+digitsArr[i]+":":i==digitsArr.length-1&&(newString+=digitsArr[i]);return newString}export function dateFormat(stringFormat,dateString){let dateParse;try{dateParse=dateString.match(/([0-9]+-[0-9]+-[0-9]+ [0-9]+:[0-9]+:[0-9]+)|([0-9]+-[0-9]+-[0-9]+)|([0-9]+:[0-9]+:[0-9]+)/g)[0]}catch(err){return}dateParse=dateParse.replaceAll("-","/");let date=new Date(Date.parse(dateParse)),months=["January","February","March","April","May","June","July","August","September","October","November","December"],dateFormat=stringFormat.replaceAll("%y",date.getFullYear());dateFormat=dateFormat.replaceAll("%d",date.getDate()),dateFormat=dateFormat.replaceAll("%lm",months[date.getMonth()]),dateFormat=dateFormat.replaceAll("%sm",months[date.getMonth()].match(/(^[A-Za-z]{0,3})/g)[0]),dateFormat=dateFormat.replaceAll("%m",date.getMonth()+1),dateFormat=date.getMinutes()>=10?dateFormat.replaceAll("%i",date.getMinutes()):dateFormat.replaceAll("%i","0"+date.getMinutes()),dateFormat=date.getSeconds()>=10?dateFormat.replaceAll("%s",date.getSeconds()):dateFormat.replaceAll("%s","0"+date.getSeconds());let hour=date.getHours();return hour>12?(dateFormat=dateFormat.replaceAll("%h",hour-12),dateFormat=dateFormat.replaceAll("%a","pm")):0==hour?(dateFormat=dateFormat.replaceAll("%h",12),dateFormat=dateFormat.replaceAll("%a","am")):(dateFormat=dateFormat.replaceAll("%h",hour),dateFormat=dateFormat.replaceAll("%a","am")),dateFormat=dateFormat.replaceAll("%H",hour),dateFormat}export function removeFix(object,fix){let newObj={};for(let k in object){let key;newObj[k.toLowerCase().replaceAll(fix,"")]=object[k]}return newObj}export function toDataURL(file){const filereader=new FileReader;return filereader.readAsDataURL(file),new Promise(resolve=>{filereader.addEventListener("load",()=>{resolve(filereader.result)})})}export function bubbleSort(array,isDescending=!1){let sortedArray=array;for(let i=0;i<sortedArray.length;i++)for(let j=0;j<sortedArray.length-i-1;j++){let cond;if(isDescending?sortedArray[j].id<sortedArray[j+1].id:sortedArray[j].id>sortedArray[j+1].id){let temp=sortedArray[j];sortedArray[j]=sortedArray[j+1],sortedArray[j+1]=temp}}return sortedArray}export function calcFlyDist(coors1,coors2){let R=6371,dLat=toRad(Math.abs(coors2[1]-coors1[1])),dLon=toRad(Math.abs(coors2[0]-coors1[0])),lat1=toRad(coors1[1]),lat2=toRad(coors2[1]),a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.sin(dLon/2)*Math.sin(dLon/2)*Math.cos(lat1)*Math.cos(lat2),c,d;return R*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}function toRad(Value){return Value*Math.PI/180}export class ImageDataConverter{constructor(dataURI){this.dataURI=dataURI}getByteString(){let byteString;return byteString=this.dataURI.split(",")[0].indexOf("base64")>=0?atob(this.dataURI.split(",")[1]):decodeURI(this.dataURI.split(",")[1]),byteString}getMimeString(){return this.dataURI.split(",")[0].split(":")[1].split(";")[0]}convertToTypedArray(){let byteString=this.getByteString(),ia=new Uint8Array(byteString.length);for(let i=0;i<byteString.length;i++)ia[i]=byteString.charCodeAt(i);return ia}dataURItoBlob(){let mimeString=this.getMimeString(),intArray=this.convertToTypedArray();return new Blob([intArray],{type:mimeString})}}export class QueryBuilder{constructor(endpoint){this.endpoint=endpoint,this.query=endpoint+"?"}select(val){if(this.query+="_select=",Array.isArray(val))for(let x=0;x<val.length;x++)x==val.length-1?this.query+=val[x]:this.query+=`${val[x]},`;else for(let v in val)for(let x=0;x<val[v].length;x++)x==val.length-1?this.query+=val[x]:this.query+=`${v}.${val[v][x]},`;return this.query+="&",this}where(matchObj){let max=Object.keys(matchObj).length,count=0;for(let s in matchObj)this.query+=`${s}=${matchObj[s]}`,0<=max-1&&(this.query+="&");return this}order(col,dir){return this.query+=`_orderby=${col}_${dir}&`,this}limit(n){return this.query+=`_limit=${n}&`,this}startAt(n){return this.query+=`_offset=${n}&`,this}batch(){return this.query+="_batch=true&",this}toString(reset=!1){let q=this.query.substring(0,this.query.length);return"&"==this.query.charAt(this.query.length-1)&&(q=q.substring(0,q.length-1)),reset&&(this.query=this.endpoint+"?"),q}join(joinInfo){let joinString="_joins=",onString="_on=";for(let j in joinInfo)joinString+=`${j},`,onString+=`${joinInfo[j][0]}=${joinInfo[j][1]},`;return joinString=joinString.substring(0,joinString.length-1),onString=onString.substring(0,onString.length-1),this.query+=`${joinString}&${onString}&`,this}compare(matchObj){let max=Object.keys(matchObj).length,operators={"!=":"_NEQ_","<":"_LSS_",">":"_GTR_","<=":"_LSE_",">=":"_GTE_"},count=0;for(let s in matchObj)this.query+=`${operators[matchObj[s][0]]}${s}=${matchObj[s][1]}`,0<=max-1&&(this.query+="&");return this}}